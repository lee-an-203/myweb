{% extends "base_admin.html" %}
{% load humanize %}
{% block content %}
<div class="container py-4">
  <h3 class="text-primary mb-4">Chi tiết đơn hàng {{ order.id }}</h3>

  <div class="card shadow-sm rounded-3">
    <div class="card-body">
      <h5 class="card-title">Thông tin đơn hàng</h5>
      <div class="row">
        <div class="col-md-6">
          <p><strong>Khách hàng:</strong> {{ order.user.username }}</p>
          <p><strong>Ngày tạo:</strong> {{ order.create_date|date:"d \T\há\n\g m, Y" }}</p>
          <p><strong>Tổng tiền:</strong> {{ order.total_amount|intcomma }} VND</p>
        </div>
        <div class="col-md-6">
          <p><strong>Số điện thoại:</strong> {{ order.phone }}</p>
          <p><strong>Địa chỉ:</strong> {{ order.address }}</p>
          <p><strong>Trạng thái:</strong>
            {% if order.status == 0 %}🕒 Đang chờ xác nhận
            {% elif order.status == 1 %}✅ Đã xác nhận
            {% elif order.status == 2 %}🚚 Đang giao hàng
            {% elif order.status == 3 %}📦 Giao hàng thành công
            {% else %}❓ Không xác định
            {% endif %}
          </p>
        </div>
      </div>

      <h5 class="mt-4">Sản phẩm trong đơn hàng</h5>
      <div style="max-height: 300px; overflow-y: auto; border: 1px solid #dee2e6; border-radius: 5px;">
        <table class="table table-bordered table-hover mb-0">
          <thead class="table-light">
            <tr>
              <th>STT</th>
              <th>Tên sản phẩm</th>
              <th>Số lượng</th>
              <th>Giá</th>
              <th>Tổng</th>
            </tr>
          </thead>
          <tbody>
            {% for detail in order.orderdetail_set.all %}
            <tr>
              <td>{{ forloop.counter }}</td>
              <td>{{ detail.product.name }}</td>
              <td>{{ detail.quantity }}</td>
              <td>{{ detail.product.price|intcomma }} VND</td>
              <td>{{ detail.amount|intcomma }} VND</td>
            </tr>
            {% empty %}
            <tr>
              <td colspan="5">Không có sản phẩm nào trong đơn hàng.</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <div class="mt-4">
        <a href="{% url 'custom_admin:order_list' %}" class="btn btn-secondary">↩ Quay lại</a>
        <a href="{% url 'custom_admin:order_export' order.id %}" class="btn btn-success ms-2">📄 Xuất hóa đơn (PDF)</a>
      </div>
    </div>
  </div>
</div>
{% endblock %}